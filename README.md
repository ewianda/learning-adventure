# Learning Adventure

An adaptive learning app for parents and kids. Parents create accounts, add child profiles, assign daily math/reading activities generated by Gemini, and review submitted work tracked in Firestore. Kids can launch the latest activity or run speech-powered spelling drills.

## Stack
- [React 18](https://react.dev/) + [Vite](https://vitejs.dev/) + TypeScript
- [Tailwind CSS](https://tailwindcss.com/)
- [Firebase Authentication](https://firebase.google.com/docs/auth) & [Cloud Firestore](https://firebase.google.com/docs/firestore)
- [Google Gemini API](https://ai.google.dev/) via `@google/generative-ai`
- [pnpm](https://pnpm.io/) for dependency management

## Prerequisites
- Node.js 20+
- `corepack` enabled (ships with Node 18+, run `corepack enable` once)
- A Firebase project with Firestore + Authentication enabled
- A Gemini API key (Google AI Studio) or Vertex AI access token

## Environment variables
Copy `.env.example` to `.env.local` (for dev) or `.env.production` (for builds) and fill in:

| Variable | Description |
| --- | --- |
| `VITE_FIREBASE_API_KEY` | Firebase web API key |
| `VITE_FIREBASE_AUTH_DOMAIN` | Firebase auth domain, e.g. `your-app.firebaseapp.com` |
| `VITE_FIREBASE_PROJECT_ID` | Firebase project ID |
| `VITE_FIREBASE_STORAGE_BUCKET` | Storage bucket, e.g. `your-app.appspot.com` |
| `VITE_FIREBASE_MESSAGING_SENDER_ID` | Messaging sender ID |
| `VITE_FIREBASE_APP_ID` | Firebase web app ID |
| `VITE_GEMINI_API_KEY` | Google AI Studio key (or leave empty if using Vertex and proxying) |
| `VITE_GEMINI_MODEL` | Gemini model name (defaults to `gemini-1.5-flash`) |

> ⚠️ Vite injects `VITE_*` variables at build time. Rebuild whenever you change them.

## Firebase configuration checklist
1. Create a Firebase project (or reuse an existing one) and register a **Web app** to obtain the config values above.
2. Enable **Email/Password** authentication under *Build → Authentication*.
3. Create a Firestore database in **production mode** (Native). The app expects the following collections:
   - `parents` documents keyed by the Firebase Auth UID storing `username`, `email`, and embedded `children` data.
   - `activities` documents keyed by `childId_YYYY-MM-DD` storing generated daily content.
4. Suggested Firestore security rules (tweak as needed):
   ```
   rules_version = '2';
   service cloud.firestore {
     match /databases/{database}/documents {
       match /parents/{parentId} {
         allow read, write: if request.auth != null && request.auth.uid == parentId;
       }
       match /activities/{activityId} {
         allow read, write: if request.auth != null;
       }
     }
   }
   ```

## Gemini configuration
1. Visit [Google AI Studio](https://aistudio.google.com/) (or configure Vertex AI if you prefer a restricted endpoint).
2. Create an API key with access to the Gemini model you want (e.g., `gemini-1.5-flash`).
3. Store the key in your `.env` file as `VITE_GEMINI_API_KEY`. *Because this runs client-side, consider proxying Gemini calls through a backend if you need stricter key protection.*

## Local development
```bash
corepack enable
pnpm install
cp .env.example .env.local # then edit the values
pnpm dev
```
- `pnpm dev` — Vite dev server with hot reload (http://localhost:5173)
- `pnpm build` — Type-check and create production assets in `dist/`
- `pnpm preview` — Serve the built app locally

## Deploying to Google Cloud (Cloud Run)
The repo ships with a multi-stage `Dockerfile` that builds the Vite app and serves static files via nginx. Because Vite bakes env vars at build time, pass all `VITE_*` secrets as build args.

1. **Build the image** (substitute your values):
   ```bash
   export PROJECT_ID=my-gcp-project
   export REGION=us-central1
   export IMAGE=gcr.io/$PROJECT_ID/learning-adventure:$(git rev-parse --short HEAD)

   docker build \
     --build-arg VITE_FIREBASE_API_KEY=... \
     --build-arg VITE_FIREBASE_AUTH_DOMAIN=... \
     --build-arg VITE_FIREBASE_PROJECT_ID=... \
     --build-arg VITE_FIREBASE_STORAGE_BUCKET=... \
     --build-arg VITE_FIREBASE_MESSAGING_SENDER_ID=... \
     --build-arg VITE_FIREBASE_APP_ID=... \
     --build-arg VITE_GEMINI_API_KEY=... \
     --build-arg VITE_GEMINI_MODEL=gemini-1.5-flash \
     -t $IMAGE .
   ```

2. **Push to Artifact Registry / Container Registry**:
   ```bash
   gcloud auth configure-docker
   docker push $IMAGE
   ```

3. **Deploy to Cloud Run**:
   ```bash
   gcloud run deploy learning-adventure \
     --image $IMAGE \
     --platform managed \
     --port 8080 \
     --allow-unauthenticated \
     --region $REGION \
     --project $PROJECT_ID
   ```

Cloud Run will serve the static site over HTTPS with automatic SSL. Because everything is pre-rendered, there are no runtime env vars to set—just redeploy when secrets change.

### Alternative: Firebase Hosting
If you prefer Firebase Hosting (also part of Google Cloud), run `pnpm build`, then:
```bash
npm install -g firebase-tools
firebase login
firebase init hosting # pick the same Firebase project and set "dist" as the public dir
firebase deploy --only hosting
```

## Testing ideas / next steps
- Add integration tests around the context provider with mocked Firebase.
- Proxy Gemini requests through a Cloud Function to keep the API key server-side.
- Expand parental controls (notifications, weekly summaries) and tighten Firestore rules further.
